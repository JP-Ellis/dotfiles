#!/bin/zsh

export CARGO_INCREMENTAL=0

try_out() {
    local ret
    export RUSTUP_HOME=$HOME/.cache/rust-update-nightly/rustup
    if [[ ! -d $RUSTUP_HOME ]] ; then
        rustup toolchain add nightly
        rustup default nightly
    fi
    rustup update
    cargo +nightly install --force clippy
    ret=$?
    unset RUSTUP_HOME
    export RUSTUP_HOME
    return $ret
}

if try_out ; then
    rustup update nightly
    cargo +nightly install --force clippy
fi
