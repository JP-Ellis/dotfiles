################################################################################
## Executes commands at the start of an interactive session.
################################################################################

# Load ZSH options
# source ~/.zshopts

# Load Zinit
source ~/.zinitrc

# Load profile
if [[ -e "$HOME/.profile" ]]; then
  source "$HOME/.profile"
fi

## ZSH Preferences
################################################################################
## The options below are documented in https://zsh.sourceforge.io/Doc/Release/Options.html

## Enable history
HISTFILE="$HOME/.cache/zsh_history"
HISTSIZE=1000000
SAVEHIST=1000000

setopt BANG_HIST
setopt EXTENDED_HISTORY
setopt HIST_ALLOW_CLOBBER
setopt HIST_EXPIRE_DUPS_FIRST
setopt HIST_FCNTL_LOCK
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_IGNORE_DUPS
setopt HIST_IGNORE_SPACE
setopt HIST_LEX_WORDS
setopt HIST_SAVE_BY_COPY
setopt HIST_SAVE_NO_DUPS
setopt HIST_VERIFY
setopt SHARE_HISTORY

## Confirm before overwriting output files
unsetopt CLOBBER

## Completion
setopt COMPLETE_IN_WORD
setopt GLOB_COMPLETE
setopt MENU_COMPLETE



## Commands
################################################################################

## Shorten `xdg-open` to just `open`, and if given multiple arguments open each
## of them individually.
open() {
  local arg
  for arg in "$@"; do
    xdg-open "$arg"
  done
}

## ls substitution
if (( $+commands[exa] )) ; then
  alias ls='exa --group-directories-first --git --binary'  # default
  alias li='ls --git-ignore'                               # use gitignore
  alias l='ls --oneline --all'                             # list for parsing
  alias ll='ls --long --header'                            # default with a bit more
  alias lr='ll --tree'                                     # recurse
  alias la='ll --all'                                      # show all
  alias lx='ll --sort=extension'                           # sort by e_x_tension
  alias lb='ll --sort=size'                                # sort by _b_ytes
  alias lc='ll --sort=created --time=created'              # sort by _c_reation date
  alias lm='ll --sort=modified --time=modified'            # sort by _m_odification date
  alias lt='lm'                                            # sort by (modification) _t_ime
  alias sl=ls                                              # typo fix
else
  alias ls='ls --group-directories-first --color=auto'     # default
  alias l='ls -1 --almost-all'                             # list for parsing
  alias ll='ls -l --human-readable'                        # default with a bit more
  alias lr='ll --recursive'                                # recurse
  alias la='ll --almost-all'                               # show all
  alias lx='ll --sort=extension'                           # sort by e_x_tension
  alias lb='ll --sort=size'                                # sort by _b_ytes
  alias lc='ll --sort=time --time=created'                 # sort by _c_reation date
  alias lm='ll --sort=time --time=modified'                # sort by _m_odification date
  alias lt='lm'                                            # sort by (modification) _t_ime
  alias sl=ls                                              # typo fix
fi

## Run ls after entering a directory
cd() {
  builtin cd "$1" && ls
}

## Shortcut to make and cd into a new directory
mkcd() {
  mkdir "$1" && cd "$1"
}

## Use bat to format man page
if (( $+commands[bat] )) ; then
  export MANPAGER="sh -c 'col -bx | bat -l man -p'"
fi

# Load starship
if (( $+commands[starship] )); then
    eval "$(starship init zsh)"
fi